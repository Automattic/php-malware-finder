/*
The Google API PHP Client (https://github.com/googleapis/google-api-php-client) is Google's official PHP library for accessing
Google APIs. It's a heavyweight but good way for extensions that use Google APIs (e.g. for OAuth) to implement the functionality
we need, and it's authoritative (as an official API), well-maintained, and a good candidate for whitelisting.

When a new version is released, you generate hashes for newly-violating files with something like:
yara -r ./php.yar /path/to/google-api-php-client-NEWVERSION | sed -e 's/.* //' | xargs sha1sum | uniq

Notes:

 - The Google API PHP Client seems to come in different "flavors" by PHP version (5.4 [!], 7.0, 7.4, 8.0) but, for v2.12.6 at
   least, we've not seen any significant difference in the files that trigger our malware scanner. In future, it may be sufficient
   to only download and test the PHP 8.0 flavor. The exception is the PHP 7.2 polyfill (from Symfony), which is unlikely to change.
 - The API embeds phpseclib, which is already whitelisted elsewhere but duplicated here in case our policy on non-embedded phpseclib
   changes, and Monolog, which is a logging management library whose design makes it suitable for both web and CLI applications
   (and some of the features it provides to support CLI applications, e.g. use of php://stdout, trip up our malware scanner).

When adding/updating lists, be sure to update ../whitelist.md too!
*/

private rule GoogleAPIPHPClient
{
	condition:
		/* PHP 7.2 Polyfill used by the Google API Client */
		hash.sha1(0, filesize) == "119ddfca28fade11d0054a8526328cb76df742e3" or // e.g. vendor/symfony/polyfill-php72/Php72.php

		/* Google API client 2.12.1 - 2.12.2 (and some locked dependencies distinct to the 2.12.1 series) */
		hash.sha1(0, filesize) == "bff5b1e332dd756cd5285e3ea9bbba424618d397" or // src/Client.php
		hash.sha1(0, filesize) == "0c5db532158835759e7389dfaa8d27fbe799872c" or // vendor/phpseclib/phpseclib/phpseclib/Net/SFTP.php
		hash.sha1(0, filesize) == "9d3d980c43dd79895802a6ab4bc9e7092f2ed5dc" or // vendor/phpseclib/phpseclib/phpseclib/Net/SSH2.php
		hash.sha1(0, filesize) == "cc7a3ef86e89b536c70beb446125a2f2998f6888" or // vendor/google/apiclient-services/src/DatabaseMigrationService/CloudSqlSettings.php
		hash.sha1(0, filesize) == "147422321d204c396fb8b96554d4cef988e86e86" or // vendor/monolog/monolog/src/Monolog/Handler/InsightOpsHandler.php
		hash.sha1(0, filesize) == "70bfd248729665a098d55ee5f21ffe0a873c919d" or // vendor/monolog/monolog/src/Monolog/Handler/StreamHandler.php

		/* Google API client 2.12.3 - 2.12.4 */
		hash.sha1(0, filesize) == "caad14d057d1a0dcf48dde2b3c46e153c4818e72" or // src/Client.php

		/* Google API client 2.12.5 */
		hash.sha1(0, filesize) == "99a8dd64f6107b3f62781c856a72b9f4c158f610" or // src/Client.php

		/* Google API client 2.12.6 (and many locked dependencies distinct to the 2.12.2+ series) */
		hash.sha1(0, filesize) == "397b4a5384a9f9e678fe757ea3c4b7d797b94df3" or // src/Client.php
		hash.sha1(0, filesize) == "5048b750ebb9b4a2163cf38d8b06139d5fa0f62c" or // vendor/google/apiclient-services/src/CertificateManager/GclbTarget.php
		hash.sha1(0, filesize) == "1bb88ea5dd0d038d5c25409d976415eac35308b0" or // vendor/google/apiclient-services/src/CertificateManager/IpConfig.php
		hash.sha1(0, filesize) == "2f14bcae31235ba4e5231be0a5053abfc841e9a1" or // vendor/google/apiclient-services/src/DatabaseMigrationService/CloudSqlSettings.php
		hash.sha1(0, filesize) == "9c11afa3e888bbe9cfb3e69e279e5d1c2571131c" or // vendor/google/apiclient-services/src/DatabaseMigrationService/CloudSqlSettings.php
		hash.sha1(0, filesize) == "08786770df112df01f07131539e953babb356609" or // vendor/monolog/monolog/src/Monolog/Handler/FingersCrossed/ChannelLevelActivationStrategy.php
		hash.sha1(0, filesize) == "b5c842295a491aca621422f17a86f93785d91995" or // vendor/monolog/monolog/src/Monolog/Handler/FingersCrossed/ChannelLevelActivationStrategy.php
		hash.sha1(0, filesize) == "531c64ee23eafef46240184cae4f178c969c621a" or // vendor/monolog/monolog/src/Monolog/Handler/InsightOpsHandler.php
		hash.sha1(0, filesize) == "67b7a9729cfb19a762101648b39dbe9d6223d03e" or // vendor/monolog/monolog/src/Monolog/Handler/InsightOpsHandler.php
		hash.sha1(0, filesize) == "5ea9f3251a4d8772dd59f1777860b8fc34f7babb" or // vendor/monolog/monolog/src/Monolog/Handler/StreamHandler.php
		hash.sha1(0, filesize) == "6d94aa73d61fd786cf8bc8882943ba4c7a5d249a" or // vendor/monolog/monolog/src/Monolog/Handler/StreamHandler.php
		hash.sha1(0, filesize) == "a62707d307fbb303a85838e1e26efb4c318e8f31" or // vendor/monolog/monolog/src/Monolog/Handler/StreamHandler.php
		hash.sha1(0, filesize) == "c82bb8141b1e4fb4ad98eb313b5dd302ab350d21" or // vendor/monolog/monolog/src/Monolog/Logger.php
		hash.sha1(0, filesize) == "705486556a52a42f84149ac87b550db5ab79e8e3" or // vendor/phpseclib/phpseclib/phpseclib/Net/SFTP.php
		hash.sha1(0, filesize) == "7e0327dc43840b460921b2183fc48a3f1b5477e1" or // vendor/phpseclib/phpseclib/phpseclib/Net/SSH2.php
		hash.sha1(0, filesize) == "5ce78df7baf162e9509a70808c91b9cc6bf5ca70" or // vendor/phpseclib/phpseclib/phpseclib/System/SSH/Agent.php
		hash.sha1(0, filesize) == "5cb79490002a0bf985479e6cac67ce38758be730" or // vendor/psr/log/Psr/Log/Test/LoggerInterfaceTest.php

		/* Google API client 2.13.0 */
		hash.sha1(0, filesize) == "2a64b8300cdf5fa94ca8b5a47d060e8a3e203e82" or // src/Client.php

		false
}
